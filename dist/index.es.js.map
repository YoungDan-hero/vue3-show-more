{"version":3,"file":"index.es.js","sources":["../src/components/ShowMore.vue","../src/index.ts"],"sourcesContent":["<template>\n  <div class=\"vue-show-more\" :class=\"customClass\">\n    <!-- Text container -->\n    <div\n      ref=\"contentRef\"\n      class=\"vue-show-more__content\"\n      :class=\"{\n        'vue-show-more__content--expanded': isExpanded,\n        'vue-show-more__content--inline':\n          actionPosition === 'inline' && !isExpanded,\n      }\"\n      :style=\"contentStyle\"\n    >\n      <div ref=\"innerContentRef\">\n        <slot></slot>\n      </div>\n    </div>\n\n    <!-- Inline button with gradient mask -->\n    <div\n      v-if=\"showButton && actionPosition === 'inline' && !isExpanded\"\n      class=\"vue-show-more__mask\"\n      @click.stop=\"toggleExpand\"\n    >\n      <slot\n        name=\"action\"\n        :is-expanded=\"isExpanded\"\n        :expand-text=\"expandText\"\n        :collapse-text=\"collapseText\"\n      >\n        <span class=\"vue-show-more__text\">{{ expandText }}</span>\n      </slot>\n    </div>\n\n    <!-- Bottom action button -->\n    <span\n      v-if=\"showButton && (actionPosition === 'bottom' || isExpanded)\"\n      class=\"vue-show-more__action-bottom\"\n      @click.stop=\"toggleExpand\"\n    >\n      <slot\n        name=\"action\"\n        :is-expanded=\"isExpanded\"\n        :expand-text=\"expandText\"\n        :collapse-text=\"collapseText\"\n      >\n        <span class=\"vue-show-more__text\">\n          {{ isExpanded ? collapseText : expandText }}\n        </span>\n      </slot>\n    </span>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, nextTick, onUnmounted, computed } from \"vue\";\n\ninterface Props {\n  maxLines?: number;\n  expandText?: string;\n  collapseText?: string;\n  class?: string;\n  expandButtonClass?: string;\n  actionPosition?: \"inline\" | \"bottom\";\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  maxLines: 3,\n  expandText: \"展开\",\n  collapseText: \"收起\",\n  class: \"\",\n  expandButtonClass: \"\",\n  actionPosition: \"bottom\",\n});\n\nconst customClass = computed(() => props.class);\n\n// Compute content styles\nconst contentStyle = computed(() => ({\n  display: \"-webkit-box\",\n  WebkitBoxOrient: \"vertical\" as const,\n  overflow: \"hidden\",\n  WebkitLineClamp: isExpanded.value ? undefined : props.maxLines,\n}));\n\nconst emit = defineEmits<{\n  (e: \"expand\", value: boolean): void;\n}>();\n\nconst isExpanded = ref(false);\nconst showButton = ref(false);\nconst contentRef = ref<HTMLElement | null>(null);\nconst innerContentRef = ref<HTMLElement | null>(null);\n\nconst toggleExpand = () => {\n  isExpanded.value = !isExpanded.value;\n  emit(\"expand\", isExpanded.value);\n};\n\nconst checkOverflow = () => {\n  if (!contentRef.value || !innerContentRef.value) return;\n  const container = contentRef.value;\n  const content = innerContentRef.value;\n\n  // Save original styles\n  const containerOriginalStyle = container.style.cssText;\n  const contentOriginalStyle = content.style.cssText;\n\n  // Create a clone element to measure clamped height\n  const clone = content.cloneNode(true) as HTMLElement;\n  clone.style.cssText = `\n    position: absolute;\n    visibility: hidden;\n    width: ${content.offsetWidth}px;\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n    -webkit-line-clamp: ${props.maxLines};\n    overflow: hidden;\n  `;\n  document.body.appendChild(clone);\n  const clampedHeight = clone.offsetHeight;\n  document.body.removeChild(clone);\n\n  // Remove all restrictions to get actual height\n  container.style.cssText =\n    \"display: block !important; overflow: visible !important; -webkit-line-clamp: none !important;\";\n  content.style.cssText = \"\";\n  const actualHeight = content.offsetHeight;\n\n  // Restore original styles\n  container.style.cssText = containerOriginalStyle;\n  content.style.cssText = contentOriginalStyle;\n\n  // Update button visibility state\n  const needsExpansion = actualHeight > clampedHeight;\n  if (showButton.value !== needsExpansion) {\n    showButton.value = needsExpansion;\n    // Reset expanded state if content doesn't need expansion\n    if (!needsExpansion && isExpanded.value) {\n      isExpanded.value = false;\n    }\n  }\n};\n\n// Watch for content changes\nconst observer = new MutationObserver(() => {\n  nextTick(() => {\n    checkOverflow();\n  });\n});\n\nonMounted(() => {\n  checkOverflow();\n  window.addEventListener(\"resize\", checkOverflow);\n\n  // Observe content changes\n  if (innerContentRef.value) {\n    observer.observe(innerContentRef.value, {\n      childList: true,\n      subtree: true,\n      characterData: true,\n    });\n  }\n});\n\nonUnmounted(() => {\n  window.removeEventListener(\"resize\", checkOverflow);\n  observer.disconnect();\n});\n</script>\n\n<style scoped>\n.vue-show-more {\n  position: relative;\n}\n\n.vue-show-more__content {\n  position: relative;\n}\n\n.vue-show-more__mask {\n  position: absolute;\n  right: 0;\n  bottom: 0;\n  cursor: pointer;\n  background: linear-gradient(to right, transparent, white 3em);\n  padding-left: 3em;\n}\n\n.vue-show-more__text {\n  position: relative;\n  z-index: 2;\n  display: inline-block;\n  color: #2196f3;\n  background: white;\n  font: inherit;\n}\n\n.vue-show-more__text:hover {\n  color: #1976d2;\n}\n\n.vue-show-more__action-bottom {\n  cursor: pointer;\n}\n</style>\n","import { App } from \"vue\";\nimport ShowMore from \"./components/ShowMore.vue\";\n\nexport { ShowMore };\n\nexport default {\n  install: (app: App) => {\n    app.component(\"ShowMore\", ShowMore);\n  },\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAkEA,UAAM,QAAQ;AASd,UAAM,cAAc,SAAS,MAAM,MAAM,KAAK;AAGxC,UAAA,eAAe,SAAS,OAAO;AAAA,MACnC,SAAS;AAAA,MACT,iBAAiB;AAAA,MACjB,UAAU;AAAA,MACV,iBAAiB,WAAW,QAAQ,SAAY,MAAM;AAAA,IACtD,EAAA;AAEF,UAAM,OAAO;AAIP,UAAA,aAAa,IAAI,KAAK;AACtB,UAAA,aAAa,IAAI,KAAK;AACtB,UAAA,aAAa,IAAwB,IAAI;AACzC,UAAA,kBAAkB,IAAwB,IAAI;AAEpD,UAAM,eAAe,MAAM;AACd,iBAAA,QAAQ,CAAC,WAAW;AAC1B,WAAA,UAAU,WAAW,KAAK;AAAA,IAAA;AAGjC,UAAM,gBAAgB,MAAM;AAC1B,UAAI,CAAC,WAAW,SAAS,CAAC,gBAAgB;AAAO;AACjD,YAAM,YAAY,WAAW;AAC7B,YAAM,UAAU,gBAAgB;AAG1B,YAAA,yBAAyB,UAAU,MAAM;AACzC,YAAA,uBAAuB,QAAQ,MAAM;AAGrC,YAAA,QAAQ,QAAQ,UAAU,IAAI;AACpC,YAAM,MAAM,UAAU;AAAA;AAAA;AAAA,aAGX,QAAQ,WAAW;AAAA;AAAA;AAAA,0BAGN,MAAM,QAAQ;AAAA;AAAA;AAG7B,eAAA,KAAK,YAAY,KAAK;AAC/B,YAAM,gBAAgB,MAAM;AACnB,eAAA,KAAK,YAAY,KAAK;AAG/B,gBAAU,MAAM,UACd;AACF,cAAQ,MAAM,UAAU;AACxB,YAAM,eAAe,QAAQ;AAG7B,gBAAU,MAAM,UAAU;AAC1B,cAAQ,MAAM,UAAU;AAGxB,YAAM,iBAAiB,eAAe;AAClC,UAAA,WAAW,UAAU,gBAAgB;AACvC,mBAAW,QAAQ;AAEf,YAAA,CAAC,kBAAkB,WAAW,OAAO;AACvC,qBAAW,QAAQ;AAAA,QACrB;AAAA,MACF;AAAA,IAAA;AAII,UAAA,WAAW,IAAI,iBAAiB,MAAM;AAC1C,eAAS,MAAM;AACC;MAAA,CACf;AAAA,IAAA,CACF;AAED,cAAU,MAAM;AACA;AACP,aAAA,iBAAiB,UAAU,aAAa;AAG/C,UAAI,gBAAgB,OAAO;AAChB,iBAAA,QAAQ,gBAAgB,OAAO;AAAA,UACtC,WAAW;AAAA,UACX,SAAS;AAAA,UACT,eAAe;AAAA,QAAA,CAChB;AAAA,MACH;AAAA,IAAA,CACD;AAED,gBAAY,MAAM;AACT,aAAA,oBAAoB,UAAU,aAAa;AAClD,eAAS,WAAW;AAAA,IAAA,CACrB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnKD,MAAe,QAAA;AAAA,EACb,SAAS,CAAC,QAAa;AACjB,QAAA,UAAU,YAAY,QAAQ;AAAA,EACpC;AACF;"}