{"version":3,"file":"index.umd.js","sources":["../src/components/ShowMore.vue","../src/index.ts"],"sourcesContent":["<template>\n  <div class=\"vue-show-more\" :class=\"customClass\">\n    <!-- Text container -->\n    <div\n      ref=\"contentRef\"\n      class=\"vue-show-more__content\"\n      :class=\"{\n        'vue-show-more__content--expanded': isExpanded,\n        'vue-show-more__content--inline':\n          actionPosition === 'inline' && !isExpanded,\n      }\"\n      :style=\"contentStyle\"\n    >\n      <div ref=\"innerContentRef\">\n        <slot></slot>\n      </div>\n    </div>\n\n    <!-- Inline button with gradient mask -->\n    <div\n      v-if=\"showButton && actionPosition === 'inline' && !isExpanded\"\n      class=\"vue-show-more__mask\"\n      :style=\"{\n        background: `linear-gradient(to right, transparent, ${maskBackground} 3em)`,\n      }\"\n      @click.stop=\"toggleExpand\"\n    >\n      <slot\n        name=\"action\"\n        :is-expanded=\"isExpanded\"\n        :expand-text=\"expandText\"\n        :collapse-text=\"collapseText\"\n      >\n        <span\n          class=\"vue-show-more__text\"\n          :style=\"{ background: maskBackground }\"\n        >\n          {{ expandText }}\n        </span>\n      </slot>\n    </div>\n\n    <!-- Bottom action button -->\n    <span\n      v-if=\"showButton && (actionPosition === 'bottom' || isExpanded)\"\n      class=\"vue-show-more__action-bottom\"\n      @click.stop=\"toggleExpand\"\n    >\n      <slot\n        name=\"action\"\n        :is-expanded=\"isExpanded\"\n        :expand-text=\"expandText\"\n        :collapse-text=\"collapseText\"\n      >\n        <span class=\"vue-show-more__text\">\n          {{ isExpanded ? collapseText : expandText }}\n        </span>\n      </slot>\n    </span>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, nextTick, onUnmounted, computed } from \"vue\";\n\ninterface Props {\n  maxLines?: number;\n  expandText?: string;\n  collapseText?: string;\n  class?: string;\n  expandButtonClass?: string;\n  actionPosition?: \"inline\" | \"bottom\";\n  maskBackground?: string;\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  maxLines: 3,\n  expandText: \"展开\",\n  collapseText: \"收起\",\n  class: \"\",\n  expandButtonClass: \"\",\n  actionPosition: \"bottom\",\n  maskBackground: \"white\",\n});\n\nconst customClass = computed(() => props.class);\n\n// Compute content styles\nconst contentStyle = computed(() => ({\n  display: \"-webkit-box\",\n  WebkitBoxOrient: \"vertical\" as const,\n  overflow: \"hidden\",\n  WebkitLineClamp: isExpanded.value ? undefined : props.maxLines,\n}));\n\nconst emit = defineEmits<{\n  (e: \"expand\", value: boolean): void;\n}>();\n\nconst isExpanded = ref(false);\nconst showButton = ref(false);\nconst contentRef = ref<HTMLElement | null>(null);\nconst innerContentRef = ref<HTMLElement | null>(null);\n\nconst toggleExpand = () => {\n  isExpanded.value = !isExpanded.value;\n  emit(\"expand\", isExpanded.value);\n};\n\nconst checkOverflow = () => {\n  if (!contentRef.value || !innerContentRef.value) return;\n  const container = contentRef.value;\n  const content = innerContentRef.value;\n\n  // Save original styles\n  const containerOriginalStyle = container.style.cssText;\n  const contentOriginalStyle = content.style.cssText;\n\n  // Create a clone element to measure clamped height\n  const clone = content.cloneNode(true) as HTMLElement;\n  clone.style.cssText = `\n    position: absolute;\n    visibility: hidden;\n    width: ${content.offsetWidth}px;\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n    -webkit-line-clamp: ${props.maxLines};\n    overflow: hidden;\n  `;\n  document.body.appendChild(clone);\n  const clampedHeight = clone.offsetHeight;\n  document.body.removeChild(clone);\n\n  // Remove all restrictions to get actual height\n  container.style.cssText =\n    \"display: block !important; overflow: visible !important; -webkit-line-clamp: none !important;\";\n  content.style.cssText = \"\";\n  const actualHeight = content.offsetHeight;\n\n  // Restore original styles\n  container.style.cssText = containerOriginalStyle;\n  content.style.cssText = contentOriginalStyle;\n\n  // Update button visibility state\n  const needsExpansion = actualHeight > clampedHeight;\n  if (showButton.value !== needsExpansion) {\n    showButton.value = needsExpansion;\n    // Reset expanded state if content doesn't need expansion\n    if (!needsExpansion && isExpanded.value) {\n      isExpanded.value = false;\n    }\n  }\n};\n\n// Watch for content changes\nconst observer = new MutationObserver(() => {\n  nextTick(() => {\n    checkOverflow();\n  });\n});\n\nonMounted(() => {\n  checkOverflow();\n  window.addEventListener(\"resize\", checkOverflow);\n\n  // Observe content changes\n  if (innerContentRef.value) {\n    observer.observe(innerContentRef.value, {\n      childList: true,\n      subtree: true,\n      characterData: true,\n    });\n  }\n});\n\nonUnmounted(() => {\n  window.removeEventListener(\"resize\", checkOverflow);\n  observer.disconnect();\n});\n</script>\n\n<style scoped>\n.vue-show-more {\n  position: relative;\n}\n\n.vue-show-more__content {\n  position: relative;\n}\n\n.vue-show-more__mask {\n  position: absolute;\n  right: 0;\n  bottom: 0;\n  cursor: pointer;\n  padding-left: 3em;\n}\n\n.vue-show-more__text {\n  position: relative;\n  z-index: 2;\n  display: inline-block;\n  color: #2196f3;\n  font: inherit;\n}\n\n.vue-show-more__text:hover {\n  color: #1976d2;\n}\n\n.vue-show-more__action-bottom {\n  cursor: pointer;\n}\n</style>\n","import { App } from \"vue\";\nimport ShowMore from \"./components/ShowMore.vue\";\n\nexport { ShowMore };\n\nexport default {\n  install: (app: App) => {\n    app.component(\"ShowMore\", ShowMore);\n  },\n};\n"],"names":["props","__props","customClass","computed","class","contentStyle","display","WebkitBoxOrient","overflow","WebkitLineClamp","isExpanded","value","maxLines","emit","__emit","ref","showButton","contentRef","innerContentRef","toggleExpand","checkOverflow","container","content","containerOriginalStyle","style","cssText","contentOriginalStyle","clone","cloneNode","offsetWidth","document","body","appendChild","clampedHeight","offsetHeight","removeChild","actualHeight","needsExpansion","observer","MutationObserver","nextTick","onMounted","window","addEventListener","observe","childList","subtree","characterData","onUnmounted","removeEventListener","disconnect","index","install","app","component","ShowMore"],"mappings":"6oBA2EA,MAAMA,EAAQC,EAURC,EAAcC,EAAAA,UAAS,IAAMH,EAAMI,QAGnCC,EAAeF,EAAAA,UAAS,KAAO,CACnCG,QAAS,cACTC,gBAAiB,WACjBC,SAAU,SACVC,gBAAiBC,EAAWC,WAAQ,EAAYX,EAAMY,aAGlDC,EAAOC,EAIPJ,EAAaK,OAAI,GACjBC,EAAaD,OAAI,GACjBE,EAAaF,MAAwB,MACrCG,EAAkBH,MAAwB,MAE1CI,EAAe,KACRT,EAAAC,OAASD,EAAWC,MAC1BE,EAAA,SAAUH,EAAWC,MAAK,EAG3BS,EAAgB,KACpB,IAAKH,EAAWN,QAAUO,EAAgBP,MAAO,OACjD,MAAMU,EAAYJ,EAAWN,MACvBW,EAAUJ,EAAgBP,MAG1BY,EAAyBF,EAAUG,MAAMC,QACzCC,EAAuBJ,EAAQE,MAAMC,QAGrCE,EAAQL,EAAQM,WAAU,GAChCD,EAAMH,MAAMC,QAAU,kEAGXH,EAAQO,yGAGK7B,EAAMY,uCAGrBkB,SAAAC,KAAKC,YAAYL,GAC1B,MAAMM,EAAgBN,EAAMO,aACnBJ,SAAAC,KAAKI,YAAYR,GAG1BN,EAAUG,MAAMC,QACd,gGACFH,EAAQE,MAAMC,QAAU,GACxB,MAAMW,EAAed,EAAQY,aAG7Bb,EAAUG,MAAMC,QAAUF,EAC1BD,EAAQE,MAAMC,QAAUC,EAGxB,MAAMW,EAAiBD,EAAeH,EAClCjB,EAAWL,QAAU0B,IACvBrB,EAAWL,MAAQ0B,GAEdA,GAAkB3B,EAAWC,QAChCD,EAAWC,OAAQ,GAEvB,EAII2B,EAAW,IAAIC,kBAAiB,KACpCC,EAAAA,UAAS,WAER,WAGHC,EAAAA,WAAU,SAEDC,OAAAC,iBAAiB,SAAUvB,GAG9BF,EAAgBP,OACT2B,EAAAM,QAAQ1B,EAAgBP,MAAO,CACtCkC,WAAW,EACXC,SAAS,EACTC,eAAe,GAEnB,IAGFC,EAAAA,aAAY,KACHN,OAAAO,oBAAoB,SAAU7B,GACrCkB,EAASY,YAAW,o9CC5KPC,EAAA,CACbC,QAAUC,IACJA,EAAAC,UAAU,WAAYC,EAAQ"}